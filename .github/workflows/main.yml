name: Node.js CI with SonarCloud

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
name: Node.js CI with SonarCloud

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      SONAR_HOST_URL: "https://sonarcloud.io"
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_PROJECT_KEY: "Manjunath-Kapanaiah_nodejs-sonar-app"
      SONAR_ORG: "manjunath-kapanaiah"

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Java 21 (required by SonarScanner 7.x)
      - name: Set up Java 21
        id: java21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'

      - name: Print Java version
        run: java -version

      # 3️⃣ Set up Node.js 18
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 4️⃣ Install dependencies (requires package-lock.json)
      - name: Install dependencies
        run: npm ci

      # 5️⃣ Run tests
      - name: Run tests
        run: npm test

      # 6️⃣ Run SonarCloud scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ env.SONAR_HOST_URL }}
          SONAR_SCANNER_OPTS: "-Djava.home=${{ steps.java21.outputs.path }}"
        with:
          args: >
            -Dsonar.projectKey=${{ env.SONAR_PROJECT_KEY }}
            -Dsonar.organization=${{ env.SONAR_ORG }}
            -Dsonar.sources=./src
            -Dsonar.tests=./tests
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
            -Dsonar.test.inclusions=tests/**/*.test.js
            -Dsonar.qualitygate.wait=true

      # 7️⃣ Deploy app locally (for demo)
      - name: Start Node.js server
        run: |
          npm start &
          sleep 10 # wait for server to start

      # 8️⃣ Test deployment endpoint
      - name: Test deployment
        run: curl http://localhost:3000
